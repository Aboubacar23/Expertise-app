{% extends 'base.html.twig' %}

{% block title %}Edit Parametre{% endblock %}

{% block body %}
<div class="">
    <div class="page-title">
        <div class="title_left">
            <h3>Expertise du projet</h3>
        </div>
    </div>
    <div class="clearfix"></div>
    <div class="row">
        <div class="col-md-12 col-sm-12 ">
            {{ form_start(form) }}
                <div class="x_panel"> 
                    <div class="x_title">
                        <h2>Paramètres généraux</h2>
                        <ul class="nav navbar-center panel_toolbox">
                            <a href="{{path('app_machine_new')}}" target="_blank" class="btn btn-outline-primary btn-sm p-1">Nouvelle machine<i class="fa fa-plus-circle p-1"></i></a>
                      
                            <a href="{{path('app_affaire_show', {'id' : parametre.affaire.id })}}"
                            class="btn btn-outline-secondary btn-sm p-1 text-uppercase">Retour<i class="fa fa-reply p-1"></i></a>
                        </ul>
                        <ul class="nav navbar-right panel_toolbox">
                            <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a></li>
                        </ul> 
                        <div class="clearfix"></div>
                    </div>
                    <div class="x_content">
                        <br />
                        <div class="item form-group">
                            <label class="col-form-label col-md-2 col-sm-2 label-align" for="type">Type <span class="required text-danger">*</span></label>
                            <div class="col-md-4 col-sm-4 ">{{ form_widget(form.type) }}</div>
                            <label class="col-form-label col-md-2 col-sm-2 label-align" for="nom_machine">Nom Machine <span class="required text-danger">*</span></label>
                            <div class="col-md-4 col-sm-4 ">{{ form_widget(form.machine) }}</div>
                        </div>
                        <div class="item form-group">
                            <label class="col-form-label col-md-2 col-sm-2 label-align" for="machine">Type Machine <span class="required text-danger">*</span></label>
                            <div class="col-md-4 col-sm-4 ">{{ form_widget(form.type_machine) }}</div>
                            <label class="col-form-label col-md-2 col-sm-2 label-align" for="machine">Critère<span class="required text-danger">*</span></label>
                            <div class="col-md-4 col-sm-4 ">{{ form_widget(form.critere) }}</div>
                        </div> 
                        <div class="item form-group">
                            <label class="col-form-label col-md-2 col-sm-2 label-align" for="puissance">Puissance(kW)<span class="required text-danger">*</span></label>
                            <div class="col-md-4 col-sm-4 ">
                                    {{ form_widget(form.puissance) }}
                            </div>
                            <label class="col-form-label col-md-2 col-sm-2 label-align" for="vitesse">Vitesse(tr/min)<span class="required text-danger">*</span></label>
                            <div class="col-md-4 col-sm-4 ">
                                    {{ form_widget(form.vitesse) }}
                            </div>
                        </div>
                        <div class="item form-group">
                            <label class="col-form-label col-md-2 col-sm-2 label-align" for="montage">Axe de la machine</label>
                            <div class="col-md-4 col-sm-4 ">
                                    {{ form_widget(form.montage) }}
                            </div>
                            <label class="col-form-label col-md-2 col-sm-2 label-align" for="masse">Masse(kg)</label>
                            <div class="col-md-4 col-sm-4 ">
                                    {{ form_widget(form.masse) }}
                            </div>
                        </div>
                        <div class="item form-group">
                            <label class="col-form-label col-md-2 col-sm-2 label-align" for="fabricant">Fabricant<span class="required text-danger">*</span></label>
                            <div class="col-md-4 col-sm-4 ">
                                {{ form_widget(form.fabricant) }}
                            </div>
                            <label class="col-form-label col-md-2 col-sm-2 label-align" for="type_palier">Type palier<span class="required text-danger">*</span></label>
                            <div class="col-md-4 col-sm-4 ">
                                {{ form_widget(form.type_palier) }}
                            </div>
                        </div>
                        <div class="item form-group">
                            <div class="col-md-4 col-sm-3 ">{{ form_widget(form.presence_balais) }}</div>
                            <div class="col-md-4 col-sm-3">{{ form_widget(form.presence_balais_masse) }}</div>
                            <div class="col-md-4 col-sm-3 ">{{ form_row(form.presence_plans) }}</div>
                        </div>
                        <div class="item form-group">
                            <label class="col-form-label col-md-2 col-sm-2 label-align" for="type_palier">Contrôle électrique
                                à reception<span class="required text-danger">*</span></label>
                            <div class="col-md-4 col-sm-4 ">
                                {{ form_widget(form.essais_plateforme) }}
                            </div>
                            <label class="col-form-label col-md-2 col-sm-2 label-align" for="type_palier">Température de Correction<span class="required text-danger">*</span></label>
                            <div class="col-md-4 col-sm-4">{{ form_widget(form.temp_correction) }}</div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="x_panel">
                            <div class="x_title">
                                <h2>Stator</h2>
                                <ul class="nav navbar-right panel_toolbox">
                                    <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a></li>
                                </ul>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <br />
                                <div class="row">
                                    <div class="col-md-6 col-sm-6 ">{{ form_row(form.stator_tension) }}</div>
                                    <div class="col-md-6 col-sm-6 ">{{ form_row(form.stator_courant) }}</div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 col-sm-6 ">{{ form_row(form.stator_frequence) }}</div>
                                    <div class="col-md-6 col-sm-6 ">{{ form_row(form.stator_couplage) }}</div>
                                </div>
                                <div class="row">
                                    <div class="col-md-4 col-sm-4 ">{{ form_row(form.date_arrivee) }}</div>
                                    <div class="col-md-4 col-sm-4 ">{{ form_row(form.stator_tension2) }}</div>
                                    <div class="col-md-4 col-sm-4 ">{{ form_row(form.stator_courant_excitation) }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="x_panel">
                            <div class="x_title">
                                <h2>Rotor</h2>
                                <ul class="nav navbar-right panel_toolbox">
                                    <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a></li>
                                </ul>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <br />
                                <div class="row">
                                    <div class="col-md-6 col-sm-6 ">{{ form_row(form.rotor_tension) }}
                                    </div>
                                    <div class="col-md-6 col-sm-6 ">{{ form_row(form.rotor_courant) }}
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 col-sm-6 ">{{ form_row(form.rotor_expertise_refrigeant) }}
                                    </div>
                                    <div class="col-md-6 col-sm-6 ">{{ form_row(form.rotor_tension2) }}
                                    </div>
                                </div>
                                <div class="row">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="x_panel">
                    <div class="x_content">                                
                        <div class="item form-group">
                            <div class="col-md-6 col-sm-6 offset-md-3 text-center">
                            <div class="row">
                                <div class="col-md-12 align-center">
                                    <button type="submit" class="btn btn-danger btn-sm text-uppercase" onclick="return confirm('Voulez-vous vraiment valider ?')">Validation des paramètres généraux<i class="fa fa-check-circle p-2"></i></button>
                                </div>
                            </div>
                            </div>
                        </div>
                    </div>
                </div>
            {{ form_end(form) }}
        </div>
    </div>
</div>
{% endblock %}
{% block javascripts %}
    <script>
        window.onload = () => {
            // On va chercher la région
            let region = document.querySelector("#parametre_type");
            const input_frequence = document.getElementById("parametre_stator_frequence");
            const input_couplage = document.getElementById("parametre_stator_couplage");
            const machine = document.getElementById("parametre_machine");
            const balais_masse = document.getElementById("parametre_presence_balais_masse");
            machine.addEventListener("click", () => {
                //Envoyer une requête AJAX pour récupérer les données de la machine choisir sélectionnée
                fetch('/index.php/parametre/frequence/' + machine.value) // Remplacez l'URL par celle de votre route Symfony
                    .then(response => response.json())
                    .then(data => {
                        console.log(data.name)
                        if (data.name == "À courant continu") {
                            input_frequence.disabled = true;
                            input_couplage.disabled = true;
                            balais_masse.disabled = true;
                        } else {
                            input_frequence.disabled = false;
                            input_couplage.disabled = false;
                            balais_masse.disabled = false;
                        }
                    });
            });
    
            region.addEventListener("change", function(){
                let form = this.closest("form");
                let data = this.name + "=" + this.value;
                fetch(form.action, {
                    method: form.getAttribute("method"),
                    body: data,
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded; charset:UTF-8"
                    }
                })
                .then(response => response.text())
                .then(html => {
                    let content = document.createElement("html");
                    content.innerHTML = html;
                    let nouveauSelect = content.querySelector("#parametre_machine");
                    console.log(nouveauSelect); 
                    if(nouveauSelect)
                    {
                        document.querySelector("#parametre_machine").replaceWith(nouveauSelect);
                    }
                })
                .catch(error => {
                    console.log(error);
                })
            });
        }
    </script>
 {% endblock %}